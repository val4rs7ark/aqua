<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mybatis.mapper.GeneralMapper">

<!-- 	<resultMap type = "java.util.Map" id="rMap">
		<result jdbcType="VARCHAR" javaType="java.lang.String" property="mem_id"/>
	</resultMap> -->
	<select id="invenList" parameterType="map" resultType="map">
    select order_no,order_gubun,order_count,order_startdate,order_indate,order_unitprice,order_enddate        
           ,ivg.ivgroup_code ivgroup_code,ivg.ivgroup_name ivgroup_name,ivg.ivgroup_gubun ivgroup_gubun
           ,ivg.ivgroup_size ivgroup_size,order_unitprice*order_count totalprice,orde.empno
           ,emp.emp_name emp_name,delivery_state  
      from order_deli orde,invengroup ivg,emp
     where orde.ivgroup_code=ivg.ivgroup_code
       and orde.empno = emp.empno
       and order_gubun in('구매','사용')
  order by order_no desc    
	</select>
<!-- 	<insert id="invenAdd" parameterType="map">
	insert into inventory(inven_no,inven_count,use_date,inven_regdate,buy_unitprice,buy_date,ivgroup_code,dept_code,buy_totalprice,empno,inven_gubun,inven_status)
	values ((select max(inven_no)+1 from inventory),#{inven_count},
		#{use_date},to_char(sysdate,'yyyy-mm-dd'),#{buy_unitprice},#{buy_date},
		'i001','d001_1',#{buy_totalprice},'a1234','구매','승인대기')
	</insert> -->
	<insert id="invenAdd" parameterType="map">
	insert into order_deli(inven_no,inven_count,use_date,inven_regdate,buy_unitprice,buy_date,ivgroup_code,dept_code,buy_totalprice,empno,inven_gubun,inven_status)
	values (#{inven_no},#{inven_count},#{use_date},to_char(sysdate,'yyyy-mm-dd'),#{buy_unitprice},#{buy_date},'i001','d001_1',#{buy_totalprice},'a1234','구매','승인대기')
	</insert>
	<insert id="invenAdd2" parameterType="map" statementType="CALLABLE">
	{call proc_invenadd(#{order_count,mode=IN, jdbcType=NUMERIC, javaType=java.lang.Integer}
	  				   ,#{order_enddate,mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
	  				   ,#{order_unitprice,mode=IN, jdbcType=NUMERIC, javaType=java.lang.Integer}
	  				   ,#{order_startdate,mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
	  				   ,#{ivgroup_code,mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
	  				   ,#{order_gubun,mode=IN, jdbcType=VARCHAR, javaType=java.lang.String})} 
	</insert>
	<select id="getInven_no" parameterType="map" resultType="int">
	select nvl(max(order_no),0)+1 from order_deli
	where order_gubun in('구매','사용')
	</select>
	<select id="getInvenTotal" parameterType="map" resultType="int">
	select count(order_no) from order_deli	
	where order_gubun in('구매','사용')
	</select>
	<select id="getInvenGroupTotal" parameterType="map" resultType="int">
	select count(ivgroup_code) from invengroup
	where ivgroup_gubun = '자산'
	</select>
	<select id="invengroupList" parameterType="map" resultType="map">
	select ivgroup_code,ivgroup_name,ivgroup_size,ivgroup_gubun 
	  from invengroup
	 where ivgroup_gubun = '자산'
	</select>
	
<!-- 	<insert id="invenAdd" parameterType="map"> =====>#{use_date,jdbcType=VARCHAR},to_char(#{buy_date,jdbcType=VARCHAR},'yyyy.mm.dd')
	insert into inventory(inven_no,inven_count,use_date,inven_regdate,buy_unitprice,buy_date,ivgroup_code,dept_code,buy_totalprice,empno,inven_gubun)
	values ((select count(inven_no)+1 from inventory),#{inven_count},
		#{use_date},to_char(sysdate,'yyyy.mm.dd'),#{buy_unitprice},#{buy_date},
		#{ivgroup_code},#{dept_code},#{buy_totalprice},#{empno},
		#{inven_gubun})
	</insert> -->

</mapper>